{% extends 'votingApp/base.html' %}
{% block title %}Cast Your Vote - e-Chayan{% endblock %}

{% block content %}
<div class="form-card" style="max-width: 800px;">
    <h1>{{ election.name }}</h1>
    <p>{{ election.description }}</p>
    
    <div class="alert-message alert-error" style="background-color: #fff3cd; color: #856404; border-color: #ffeeba;">
        <strong>Warning:</strong> You can only vote ONCE. This action cannot be undone.
    </div>

    {% if error %}
        <div class="alert-message alert-error">{{ error }}</div>
    {% endif %}

    <form method="POST">
        {% csrf_token %}
        <div class="form-group" style="margin-top: 30px;">
            
            <h4 class="mb-3">Select your Candidate:</h4>

            {% for candidate in election.candidates.all %}
            <div class="card mb-3" style="border: 1px solid #dee2e6;">
                <div class="card-body d-flex align-items-center">
                    
                    <div style="margin-right: 15px;">
                        <input type="radio" id="candidate-{{ candidate.id }}" name="candidate" value="{{ candidate.id }}" style="width: 25px; height: 25px;" required>
                    </div>

                    <div style="margin-right: 20px;">
                        {% if candidate.candidate_photo %}
                            <img src="{{ candidate.candidate_photo.url }}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 1px solid #ccc;">
                        {% else %}
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ‘¤</div>
                        {% endif %}
                    </div>

                    <div style="flex-grow: 1;">
                        <label for="candidate-{{ candidate.id }}" style="font-size: 1.2em; font-weight: bold; margin: 0; cursor: pointer; display: block;">
                            {{ candidate.name }}
                        </label>
                        
                        <p style="margin: 0; color: #666;">
                            {% if candidate.is_independent %}
                                <span class="badge bg-secondary">Independent</span>
                            {% else %}
                                {% if candidate.party %}
                                    <strong>Party:</strong> {{ candidate.party.name }} 
                                    {% if candidate.party.abbreviation %}
                                        ({{ candidate.party.abbreviation }})
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Unknown Affiliation</span>
                                {% endif %}
                            {% endif %}
                        </p>
                    </div>

                    <div style="margin-left: 15px;">
                        {% if candidate.is_independent %}
                            <div style="width: 50px; text-align: center; color: #888;" title="Independent">
                                <i class="bi bi-person-fill" style="font-size: 2rem;"></i>
                            </div>
                        {% else %}
                            {% if candidate.party and candidate.party.symbol %}
                                <img src="{{ candidate.party.symbol.url }}" style="width: 50px; height: 50px; object-fit: contain;" title="{{ candidate.party.name }}">
                            {% else %}
                                <div style="width: 50px; text-align: center; color: #ccc;">
                                    <i class="bi bi-flag" style="font-size: 2rem;"></i>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>

                </div>
            </div>
            {% endfor %}
            
        </div>
        
        <div class="text-center mt-4">
            <button type="submit" class="btn" style="background-color: var(--success-color); max-width: 300px; font-size: 1.2em;">Confirm and Cast Vote</button>
            <br><br>
            <a href="{% url 'dashboard' %}" style="color: #666;">Cancel and return to Dashboard</a>
        </div>
    </form>
</div>
{% endblock %}