{% extends 'votingApp/base.html' %}
{% block title %}Dashboard - e-Chayan{% endblock %}

{% block content %}
<div class="container">

    {% if user.candidate %}
    <div class="tab-toggle-container" style="max-width: 600px; margin: 20px auto;">
        
        <a href="{% url 'candidate_dashboard' %}" class="tab-toggle-btn" style="text-decoration: none;">
            <i class="bi bi-person-workspace"></i> Manage Campaign
        </a>

        <div class="tab-toggle-btn active">
            <i class="bi bi-check2-circle"></i> Cast My Vote
        </div>
        
    </div>
    {% endif %}
    <h1>Welcome, {{ user.first_name }}!</h1>

    <div class="election-card">
      <h3>Your Voter Profile</h3>
      <p><strong>Name:</strong> {{ user.first_name }} {{ user.last_name }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>State:</strong> {{ user.userprofile.get_state_display }}</p>
      <p>
        <strong>Verification Status:</strong>
        {% if user.userprofile.is_verified %}
            <span style="color: var(--success-color)">Verified</span>
        {% else %}
            <span style="color: var(--error-color)">Not Verified</span>
            <br><small>Your profile is under review by an admin. You cannot vote until verified.</small>
        {% endif %}
      </p>
    </div>

    <h2>Available Elections</h2>

    {% for election in eligible_elections %}
    <div class="election-card">
      <h3>{{ election.name }}</h3>
      <p>{{ election.description }}</p>
      <p><strong>Type:</strong> {{ election.get_election_type_display }}</p>
      <p><strong>Ends:</strong> {{ election.end_time }}</p>

      {% if election.user_has_voted %}
          <span class="btn-voted">Already Voted</span>
      {% else %}
          <a href="{% url 'vote_page' election_slug=election.slug %}" class="btn-vote">Vote Now</a>
      {% endif %}
    </div>
    {% empty %}
        <p>There are no active elections you are eligible for at this time.</p>
    {% endfor %}
    
</div>
{% endblock %}